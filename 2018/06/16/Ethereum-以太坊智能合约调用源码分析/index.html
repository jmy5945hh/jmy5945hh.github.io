<!DOCTYPE html PUBLIC "-//WAPFORUM//DTD XHTML Mobile 1.0//EN" "http://www.wapforum.org/DTD/xhtml-mobile10.dtd">
<html>
  <head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=yes">
  
  
  <title>  Ethereum &#x4EE5;&#x592A;&#x574A;&#x667A;&#x80FD;&#x5408;&#x7EA6;&#x8C03;&#x7528;&#x6E90;&#x7801;&#x5206;&#x6790; |   Jmy5945hh-Fintech&#x6280;&#x672F;&#x535A;&#x5BA2; </title>

 
  
    <link rel="icon" href="/images/favicon.png">
  


  <link rel="stylesheet" href="/style.min.css"> 
</head>  
  <body>   
    <header class="header">
	
  <nav class="header-nav">        
   
    <span class="iconfont icon-menu mobile-toggle"></span>   	

    <a class="header-logo" href="/"><span>Jmy</span></a>  

    <div class="header-menu">          
              
            

              <a class="header-menu-link" id="header-menu-home" href="/">&#x9996;&#x9875;</a>     

            
            
            

              <a class="header-menu-link" id="header-menu-archives" href="/archives">&#x5F52;&#x6863;</a>     

            
            
            

              <a class="header-menu-link" id="header-menu-tags" href="/tags">&#x6807;&#x7B7E;</a>     

            
            
            

              <a class="header-menu-link" id="header-menu-about" href="/about">&#x5173;&#x4E8E;</a>     

            
            
            

              <a class="iconfont icon-menu-search header-menu-link" id="header-menu-search"></a>

            
                
    </div>  
    
  </nav>
</header>   

    <div class="container">       
        
        

          <section class="main">  

        

        <article class="post">

	  
	<div class="post-header slideDownMin">

	<p class="post-title">	
		Ethereum &#x4EE5;&#x592A;&#x574A;&#x667A;&#x80FD;&#x5408;&#x7EA6;&#x8C03;&#x7528;&#x6E90;&#x7801;&#x5206;&#x6790;
	</p>
			

	<div class="meta-info">	
	<span>
		6&#x6708; 16, 2018
	</span>

	
	
		<i class="iconfont icon-words"></i>
		<span>
			20805
		</span>
	
</div>

</div> 

	 

	  <div class="post-content slideDownMin">

		

	  	<h2 id="0-&#x524D;&#x8A00;"><a href="#0-&#x524D;&#x8A00;" class="headerlink" title="0 &#x524D;&#x8A00;"></a>0 &#x524D;&#x8A00;</h2><ul>
<li>&#x57FA;&#x4E8E; Ethereum Coffice (v.1.8.8) &#x5206;&#x6790;</li>
<li>&#x9700;&#x8981;&#x533A;&#x5757;&#x94FE;&#x57FA;&#x7840;&#x77E5;&#x8BC6;</li>
<li>&#x6709; C++/JAVA &#x57FA;&#x7840;&#x5C31;&#x80FD;&#x7406;&#x89E3;&#x6587;&#x4E2D; go &#x4EE3;&#x7801;</li>
<li>&#x672C;&#x6587;<strong>&#x4E0D;&#x5305;&#x542B;</strong>&#x5408;&#x7EA6;&#x90E8;&#x7F72;&#x7684;&#x524D;&#x5E8F;&#x6B65;&#x9AA4;&#xFF0C;&#x5373;sol&#x6E90;&#x7801;&#x7F16;&#x8BD1;&#x6253;&#x5305;&#x8FC7;&#x7A0B;&#xFF0C;&#x8BF7;&#x53C2;&#x8003;&#x7F51;&#x7EDC;&#x4E0A;&#x5176;&#x4ED6;&#x6587;&#x7AE0;</li>
<li>&#x6D41;&#x7A0B;&#x56FE;&#x4F7F;&#x7528; <a href="https://www.processon.com" target="_blank" rel="noopener">ProcessOn.com</a> &#x5728;&#x7EBF;&#x7ED8;&#x5236; </li>
<li>&#x5408;&#x7EA6;&#x8C03;&#x7528;&#x4E0E;&#x4EA4;&#x6613;&#x7684;&#x6D41;&#x7A0B;&#x5927;&#x540C;&#x5C0F;&#x5F02;&#xFF0C;&#x53EF;&#x53C2;&#x8003;&#x4E4B;&#x524D;&#x7B14;&#x8005;&#x6587;&#x7AE0;&#x201C;Ethereum &#x4EE5;&#x592A;&#x574A;&#x667A;&#x80FD;&#x5408;&#x7EA6;&#x90E8;&#x7F72;&#x6E90;&#x7801;&#x5206;&#x6790;&#x201D;</li>
</ul>
<hr>
<p><strong>&#x6574;&#x4F53;&#x6D41;&#x7A0B;&#x56FE;&#x5982;&#x4E0B;&#x6240;&#x793A;</strong>&#xFF1A;<br><img src="Ethereum-&#x4EE5;&#x592A;&#x574A;&#x667A;&#x80FD;&#x5408;&#x7EA6;&#x8C03;&#x7528;&#x6E90;&#x7801;&#x5206;&#x6790;/EthereumInvoke.jpg" alt="image"></p>
<a id="more"></a>
<h2 id="1-API-&#x53D1;&#x8D77;&#x667A;&#x80FD;&#x5408;&#x7EA6;&#x6267;&#x884C;&#x4EA4;&#x6613;"><a href="#1-API-&#x53D1;&#x8D77;&#x667A;&#x80FD;&#x5408;&#x7EA6;&#x6267;&#x884C;&#x4EA4;&#x6613;" class="headerlink" title="1 API &#x53D1;&#x8D77;&#x667A;&#x80FD;&#x5408;&#x7EA6;&#x6267;&#x884C;&#x4EA4;&#x6613;"></a>1 API &#x53D1;&#x8D77;&#x667A;&#x80FD;&#x5408;&#x7EA6;&#x6267;&#x884C;&#x4EA4;&#x6613;</h2><p>&#x5728;&#x90E8;&#x7F72;&#x597D;&#x7684;&#x667A;&#x80FD;&#x5408;&#x7EA6;&#x4E0A;&#xFF0C;&#x53EF;&#x4EE5;&#x53D1;&#x8D77;&#x5408;&#x7EA6;&#x8C03;&#x7528;&#x3002;&#x6BCF;&#x6B21;&#x5408;&#x7EA6;&#x8C03;&#x7528;&#x5C06;&#x751F;&#x6210;&#x4E00;&#x7B14;&#x65B0;&#x7684;&#x4EA4;&#x6613;&#xFF0C;Ethereum &#x533A;&#x5757;&#x94FE;&#x7F51;&#x7EDC;&#x9700;&#x8981;&#x5904;&#x7406;&#x4EA4;&#x6613;&#x4E0A;&#x94FE;&#x4E8B;&#x4EF6;&#x3002;&#x4E0B;&#x9762;&#x662F;&#x4EA4;&#x6613;&#x53D1;&#x8D77;&#x8FC7;&#x7A0B;&#x7528;&#x5230;&#x7684;&#x4E24;&#x4E2A;&#x4E3B;&#x8981;&#x6570;&#x636E;&#x7ED3;&#x6784;&#xFF1A;  </p>
<h3 id="1-1-&#x76F8;&#x5173;&#x6570;&#x636E;&#x7ED3;&#x6784;"><a href="#1-1-&#x76F8;&#x5173;&#x6570;&#x636E;&#x7ED3;&#x6784;" class="headerlink" title="1.1 &#x76F8;&#x5173;&#x6570;&#x636E;&#x7ED3;&#x6784;"></a>1.1 &#x76F8;&#x5173;&#x6570;&#x636E;&#x7ED3;&#x6784;</h3><ul>
<li><p>&#x5BA2;&#x6237;&#x7AEF;&#x4FA7;&#x4F20;&#x8F93;&#x6570;&#x636E;&#x7ED3;&#x6784;&#x5C55;&#x793A;&#xFF1A;</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">file: ethapi\api.go</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">type</span> SendTxArgs <span class="keyword">struct</span> {</span><br><span class="line">    From     common.Address  <span class="string">`json:&quot;from&quot;`</span></span><br><span class="line">    To       *common.Address <span class="string">`json:&quot;to&quot;`</span></span><br><span class="line">    Gas      *hexutil.Uint64 <span class="string">`json:&quot;gas&quot;`</span></span><br><span class="line">    GasPrice *hexutil.Big    <span class="string">`json:&quot;gasPrice&quot;`</span></span><br><span class="line">    Value    *hexutil.Big    <span class="string">`json:&quot;value&quot;`</span></span><br><span class="line">    Nonce    *hexutil.Uint64 <span class="string">`json:&quot;nonce&quot;`</span></span><br><span class="line">    Data  *hexutil.Bytes <span class="string">`json:&quot;data&quot;`</span></span><br><span class="line">    Input *hexutil.Bytes <span class="string">`json:&quot;input&quot;`</span></span><br><span class="line">}</span><br></pre></td></tr></table></figure>
</li>
<li><p>Ethereum &#x4EA4;&#x6613;&#x6570;&#x636E;&#x7ED3;&#x6784;&#x5C55;&#x793A;&#xFF1A;</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">file: core\types\transaction.go</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">type</span> Transaction <span class="keyword">struct</span> {</span><br><span class="line">    data txdata</span><br><span class="line">    hash atomic.Value</span><br><span class="line">    size atomic.Value</span><br><span class="line">    from atomic.Value</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> txdata <span class="keyword">struct</span> {</span><br><span class="line">    AccountNonce <span class="keyword">uint64</span>          <span class="string">`json:&quot;nonce&quot;    gencodec:&quot;required&quot;`</span></span><br><span class="line">    Price        *big.Int        <span class="string">`json:&quot;gasPrice&quot; gencodec:&quot;required&quot;`</span></span><br><span class="line">    GasLimit     <span class="keyword">uint64</span>          <span class="string">`json:&quot;gas&quot;      gencodec:&quot;required&quot;`</span></span><br><span class="line">    Recipient    *common.Address <span class="string">`json:&quot;to&quot;       rlp:&quot;nil&quot;`</span></span><br><span class="line">    Amount       *big.Int        <span class="string">`json:&quot;value&quot;    gencodec:&quot;required&quot;`</span></span><br><span class="line">    Payload      []<span class="keyword">byte</span>          <span class="string">`json:&quot;input&quot;    gencodec:&quot;required&quot;`</span></span><br><span class="line"></span><br><span class="line">    V *big.Int <span class="string">`json:&quot;v&quot; gencodec:&quot;required&quot;`</span></span><br><span class="line">    R *big.Int <span class="string">`json:&quot;r&quot; gencodec:&quot;required&quot;`</span></span><br><span class="line">    S *big.Int <span class="string">`json:&quot;s&quot; gencodec:&quot;required&quot;`</span></span><br><span class="line"></span><br><span class="line">    Hash *common.Hash <span class="string">`json:&quot;hash&quot; rlp:&quot;-&quot;`</span></span><br><span class="line">}</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="1-2-&#x6D41;&#x7A0B;&#x56FE;&#x7EC6;&#x8282;"><a href="#1-2-&#x6D41;&#x7A0B;&#x56FE;&#x7EC6;&#x8282;" class="headerlink" title="1.2 &#x6D41;&#x7A0B;&#x56FE;&#x7EC6;&#x8282;"></a>1.2 &#x6D41;&#x7A0B;&#x56FE;&#x7EC6;&#x8282;</h3><ol>
<li><p><code>ethapi/api.go</code> &#x8BC6;&#x522B;&#x5230;&#x8FD9;&#x662F;&#x4E00;&#x6B21;&#x4EA4;&#x6613;&#x53D1;&#x9001;&#x8BF7;&#x6C42;&#xFF0C;&#x8C03;&#x7528; <code>SendTransaction()</code> &#x51FD;&#x6570;&#xFF0C;&#x8FDB;&#x4E00;&#x6B65;&#x5411;&#x5E95;&#x5C42;&#x53D1;&#x9001;&#x6D88;&#x606F;&#x3002;&#x9996;&#x5148;&#xFF0C;&#x51FD;&#x6570;&#x4F1A;&#x68C0;&#x67E5;&#x53D1;&#x9001;&#x4EA4;&#x6613;&#x8D26;&#x6237;&#x7684;&#x5408;&#x6CD5;&#x6027;&#xFF0C;&#x5E76;&#x4E14;&#x4E3A;&#x4EA4;&#x6613;&#x8BBE;&#x7F6E;&#x4E00;&#x7CFB;&#x5217;&#x7684;&#x521D;&#x59CB;&#x503C;&#xFF0C;&#x4F8B;&#x5982; gas, nonce &#x7B49;&#x3002;&#x4EA4;&#x6613;&#x4FE1;&#x606F;&#x586B;&#x6EE1;&#x540E;&#xFF0C;&#x653E;&#x5230;&#x4EA4;&#x6613;&#x6C60;&#x4E2D;&#xFF0C;&#x7B49;&#x5F85;&#x4E0B;&#x4E00;&#x6B65;&#x5904;&#x7406;&#x3002;<br> 1a. &#x6839;&#x636E;&#x4F20;&#x5165;&#x4FE1;&#x606F;&#x521B;&#x5EFA; <code>Transaction</code> &#x3002;&#x6CE8;&#x610F;&#x6B64;&#x5904;&#x6709;&#x4E2A;&#x5224;&#x65AD;&#x8BED;&#x53E5;&#xFF0C;&#x6839;&#x636E; <code>To</code> &#x662F;&#x5426;&#x6709;&#x503C;&#x6765;&#x786E;&#x5B9A;&#x662F;&#x5408;&#x7EA6;&#x521B;&#x5EFA;&#x6216;&#x8C03;&#x7528;&#x3002;</p>
 <figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> args.To == <span class="literal">nil</span> { <span class="comment">// &#x5408;&#x7EA6;&#x8C03;&#x7528;&#x65F6;&#xFF0C;&#x6B64;&#x5904;to&#x4E0D;&#x4E3A;&#x7A7A;</span></span><br><span class="line">    <span class="keyword">return</span> types.NewContractCreation(...)</span><br><span class="line">}</span><br><span class="line"><span class="keyword">return</span> types.NewTransaction(...)</span><br></pre></td></tr></table></figure>
<p> 1b. <code>SignTx()</code> &#x4F7F;&#x7528;&#x4EA4;&#x6613;&#x53D1;&#x8D77;&#x8005;&#x4FE1;&#x606F;&#x5BF9;&#x4EA4;&#x6613;&#x8FDB;&#x884C;&#x7B7E;&#x540D;&#x3002;&#x6B64;&#x5904;&#x6709;wallet&#x7684;&#x6982;&#x5FF5;&#xFF0C;&#x5B98;&#x65B9;&#x6E90;&#x7801;&#x6CE8;&#x91CA;&#x4E2D;&#x591A;&#x6B21;&#x63D0;&#x5230;&#x201C;USB&#x201D;&#x3002;&#x7B14;&#x8005;&#x7F51;&#x4E0A;&#x68C0;&#x7D22;&#x540E;&#x77E5;&#x9053;&#x8FD9;&#x662F;&#x4EE5;&#x592A;&#x574A;&#x63A8;&#x51FA;&#x7684;&#x786C;&#x4EF6;&#x94B1;&#x5305;&#xFF0C;&#x5B83;&#x662F;&#x4E00;&#x4E2A;&#x5B89;&#x5168;&#x5B58;&#x50A8;&#x79C1;&#x94A5;&#x7684;&#x786C;&#x4EF6;&#x8BBE;&#x5907;&#xFF0C;&#x901A;&#x8FC7;USB&#x4E0E;&#x7535;&#x8111;&#x8FDE;&#x63A5;&#x3002;&#x5728;&#x8FDB;&#x884C;&#x4EA4;&#x6613;&#x65F6;&#xFF0C;&#x53D1;&#x9001;&#x4EA4;&#x6613;&#x5230; Ethereum &#x533A;&#x5757;&#x94FE;&#x7F51;&#x7EDC;&#x65F6;&#xFF0C;&#x9700;&#x8981;&#x4F7F;&#x7528;&#x786C;&#x4EF6;&#x94B1;&#x5305;&#x7684;&#x79C1;&#x94A5;&#x8FDB;&#x884C;&#x4EA4;&#x6613;&#x7B7E;&#x540D;&#x3002;&#x4E0B;&#x9762;&#x5F15;&#x7528;&#x4E00;&#x6BB5;&#x5BF9;&#x4E8E;&#x786C;&#x4EF6;&#x94B1;&#x5305;&#x7684;&#x8BF4;&#x660E;&#xFF1A;</p>
<blockquote>
<p>Ledger&#x7684;&#x786C;&#x4EF6;&#x94B1;&#x5305;&#x56F4;&#x7ED5;&#x201C;&#x5B89;&#x5168;&#x5143;&#x4EF6;&#x201D;&#x6216;&#x5B89;&#x5168;&#x82AF;&#x7247;&#x8FDB;&#x884C;&#x67B6;&#x6784;&#x3002;&#x8FD9;&#x662F;&#x548C;&#x82AF;&#x7247;&#x53CA;PIN&#x652F;&#x4ED8;&#x6216;SIM&#x5361;&#x4E2D;&#x4F7F;&#x7528;&#x7684;&#x76F8;&#x540C;&#x6280;&#x672F;&#x3002;&#x8FD9;&#x4E9B;&#x82AF;&#x7247;&#x4E3A;&#x7269;&#x7406;&#x653B;&#x51FB;&#x63D0;&#x4F9B;&#x4FDD;&#x62A4;&#xFF0C;&#x5927;&#x5927;&#x63D0;&#x5347;&#x79C1;&#x94A5;&#x7684;&#x5B89;&#x5168;&#x6027;&#x3002; &#x6211;&#x4EEC;&#x7684;&#x7814;&#x53D1;&#x4EBA;&#x5458;&#x6765;&#x81EA;&#x5B89;&#x5168;&#x884C;&#x4E1A;&#xFF08;&#x66FE;&#x670D;&#x52A1;&#x4E8E;&#x6570;&#x5B57;&#x5B89;&#x5168;&#x9886;&#x57DF;&#x7684;&#x5168;&#x7403;&#x9886;&#x5148;&#x4F01;&#x4E1A;Gemalto&#x91D1;&#x96C5;&#x62D3;&#xFF0C;Oberthur &#x6B27;&#x8D1D;&#x7279;&#x7B49;&#x4F01;&#x4E1A;&#xFF09;&#xFF0C;&#x6211;&#x4EEC;&#x5728;&#x667A;&#x80FD;&#x5361;&#x548C;&#x5B89;&#x5168;&#x5D4C;&#x5165;&#x5F0F;&#x64CD;&#x4F5C;&#x7CFB;&#x7EDF;&#x9886;&#x57DF;&#x62E5;&#x6709;&#x4E30;&#x5BCC;&#x7684;&#x7ECF;&#x9A8C;&#x3002;</p>
 <figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> chainID *big.Int</span><br><span class="line"><span class="keyword">if</span> config := s.b.ChainConfig(); config.IsEIP155(s.b.CurrentBlock().Number()) {</span><br><span class="line">    chainID = config.ChainId</span><br><span class="line">}</span><br><span class="line">signed, err := wallet.SignTx(account, tx, chainID)</span><br></pre></td></tr></table></figure>
</blockquote>
<p> &#x82E5;&#x662F;&#x68C0;&#x6D4B;&#x5230; Ethereum &#x8F6F;&#x4EF6;&#x672A;&#x8FD0;&#x884C;&#xFF0C;&#x5C06;&#x76F4;&#x63A5;&#x53CD;&#x9988;&#x7A7A;&#x7684;&#x4EA4;&#x6613;&#x4FE1;&#x606F;</p>
 <figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">file: accouts\usbwallet\ledger.go</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">if</span> w.offline() {</span><br><span class="line">    <span class="keyword">return</span> common.Address{}, <span class="literal">nil</span>, accounts.ErrWalletClosed</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<p> 1c. <code>submitTransaction()</code> &#x5C06;&#x4EA4;&#x6613;&#x63A8;&#x8FDB;&#x4EA4;&#x6613;&#x6C60;&#xFF0C;&#x7B49;&#x5F85;&#x4E0B;&#x4E00;&#x6B65;&#x5904;&#x7406;&#x3002;</p>
 <figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">submitTransaction</span><span class="params">(...)</span> <span class="params">(common.Hash, error)</span></span> {</span><br><span class="line">    <span class="keyword">if</span> err := b.SendTx(ctx, tx); err != <span class="literal">nil</span> {</span><br><span class="line">        <span class="keyword">return</span> common.Hash{}, err</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">if</span> tx.To() == <span class="literal">nil</span> {</span><br><span class="line">        ...</span><br><span class="line">        addr := crypto.CreateAddress(from, tx.Nonce())</span><br><span class="line">        log.Info(... <span class="string">&quot;contract&quot;</span>, addr.Hex())</span><br><span class="line">    } </span><br><span class="line">    ...</span><br><span class="line">    <span class="keyword">return</span> tx.Hash(), <span class="literal">nil</span></span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<p> &#x5165;&#x6C60;&#x64CD;&#x4F5C;&#x4F1A;&#x8C03;&#x7528;&#x5982;&#x4E0B;&#x5173;&#x952E;&#x51FD;&#x6570;&#x3002;&#x4EA4;&#x6613;&#x6C60;&#x5206;&#x4E3A;&#x4E24;&#x4E2A;&#x4EA4;&#x6613;&#x5217;&#x8868;&#xFF0C; <code>pending</code> &#x4E2D;&#x5B58;&#x653E;&#x53EF;&#x6267;&#x884C;&#x7684;&#x4EA4;&#x6613;&#xFF0C; <code>queue</code> &#x4E2D;&#x5B58;&#x653E;&#x6392;&#x961F;&#x4E2D;&#x6682;&#x4E0D;&#x53EF;&#x6267;&#x884C;&#x7684;&#x4EA4;&#x6613;&#xFF0C;&#x4ED6;&#x4EEC;&#x4E4B;&#x95F4;&#x53EF;&#x4EE5;&#x76F8;&#x4E92;&#x8F6C;&#x6362;&#x3002;&#x5165;&#x6C60;&#x4E4B;&#x524D;&#xFF0C;<code>pool.validateTx()</code> &#x4F1A;&#x5BF9;&#x4EA4;&#x6613;&#x7B7E;&#x540D;&#x8FDB;&#x884C;&#x521D;&#x6B65;&#x68C0;&#x67E5;&#xFF0C;&#x5BF9;&#x4E8E;&#x4E00;&#x7B14;&#x5408;&#x6CD5;&#x7684;&#x65B0;&#x4EA4;&#x6613;&#xFF0C; <code>pool.enqueueTx()</code> &#x4F1A;&#x5C06;&#x5176;&#x5148;&#x653E;&#x5165; <code>queue</code> &#x5217;&#x8868;&#xFF0C;&#x968F;&#x540E; <code>promoteExecutables()</code> &#x89C6;&#x6761;&#x4EF6;&#x5C06;&#x5176;&#x79FB;&#x5165; <code>pending</code> &#x4E2D;&#x3002;</p>
 <figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">file: core\tx_pool.go</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(pool *TxPool)</span> <span class="title">addTx</span><span class="params">(...)</span> <span class="title">error</span></span> {</span><br><span class="line">    ...</span><br><span class="line">    replace, err := pool.add(tx, local)</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> {</span><br><span class="line">        <span class="keyword">return</span> err</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> !replace {</span><br><span class="line">        from, _ := types.Sender(pool.signer, tx) </span><br><span class="line">        pool.promoteExecutables([]common.Address{from})</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">}</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h2 id="2-Worker-&#x4EA4;&#x6613;&#x6253;&#x5305;&#x51FA;&#x5757;"><a href="#2-Worker-&#x4EA4;&#x6613;&#x6253;&#x5305;&#x51FA;&#x5757;" class="headerlink" title="2 Worker &#x4EA4;&#x6613;&#x6253;&#x5305;&#x51FA;&#x5757;"></a>2 Worker &#x4EA4;&#x6613;&#x6253;&#x5305;&#x51FA;&#x5757;</h2><p>&#x968F;&#x7740;&#x4EA4;&#x6613;&#x6C60;&#x7684;&#x589E;&#x957F;&#xFF0C;&#x77FF;&#x5DE5;&#x670D;&#x52A1;&#x6839;&#x636E;&#x4E00;&#x5B9A;&#x7684;&#x6761;&#x4EF6;&#x5B8C;&#x6210;&#x4EA4;&#x6613;&#x6253;&#x5305;&#x4E0E;&#x51FA;&#x5757;&#x64CD;&#x4F5C;&#x3002;&#x751F;&#x6210;&#x7684;&#x5757;&#x5C06;&#x5728;&#x7F51;&#x7EDC;&#x4E2D;&#x901A;&#x8FC7;P2P&#x670D;&#x52A1;&#x4F20;&#x64AD;&#x3002;<br>(&#x7EC6;&#x8282;&#x5F85;&#x5B8C;&#x6210;)</p>
<h2 id="3-Blockchain-&#x533A;&#x5757;&#x4E0A;&#x94FE;"><a href="#3-Blockchain-&#x533A;&#x5757;&#x4E0A;&#x94FE;" class="headerlink" title="3 Blockchain &#x533A;&#x5757;&#x4E0A;&#x94FE;"></a>3 Blockchain &#x533A;&#x5757;&#x4E0A;&#x94FE;</h2><h3 id="3-1-&#x6982;&#x8FF0;"><a href="#3-1-&#x6982;&#x8FF0;" class="headerlink" title="3.1 &#x6982;&#x8FF0;"></a>3.1 &#x6982;&#x8FF0;</h3><p>&#x5728;&#x6536;&#x5230;&#x7F51;&#x7EDC;&#x4E0A;&#x7684;&#x4F20;&#x9001;&#x6765;&#x7684;&#x533A;&#x5757;&#x540E;&#xFF0C;&#x89E6;&#x53D1; <code>blockchain.go</code> &#x7684; <code>InsertChain()</code> &#x51FD;&#x6570;&#xFF0C;&#x8FDB;&#x5165;&#x533A;&#x5757;&#x7684;&#x5904;&#x7406;&#x8FC7;&#x7A0B;: <strong><em>&#x533A;&#x5757;&#x94FE;&#x6821;&#x9A8C; -&gt; &#x533A;&#x5757;&#x5934;&#x9A8C;&#x8BC1;-&gt;&#x533A;&#x5757;&#x4F53;&#x9A8C;&#x8BC1;-&gt;&#x4EA4;&#x6613;&#x5904;&#x7406;-&gt;&#x72B6;&#x6001;&#x9A8C;&#x8BC1;-&gt;&#x533A;&#x5757;&#x4E0A;&#x94FE;</em></strong>&#x3002;<br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">file: core\blockchain.go</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(bc *BlockChain)</span> <span class="title">insertChain</span><span class="params">(chain types.Blocks)</span> <span class="params">(...)</span></span> {</span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">1</span>; i &lt; <span class="built_in">len</span>(chain); i++ {</span><br><span class="line">        <span class="keyword">if</span> chain[i].NumberU64() != chain[i<span class="number">-1</span>].NumberU64()+<span class="number">1</span> || chain[i].ParentHash() != chain[i<span class="number">-1</span>].Hash() {</span><br><span class="line">            ...</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>, <span class="literal">nil</span>, <span class="literal">nil</span>, ...</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    ...</span><br><span class="line">    abort, results := bc.engine.VerifyHeaders(...)</span><br><span class="line">    ...</span><br><span class="line">    <span class="keyword">for</span> i, block := <span class="keyword">range</span> chain {</span><br><span class="line">        ...</span><br><span class="line">        err := &lt;-results</span><br><span class="line">        <span class="keyword">if</span> err == <span class="literal">nil</span> {</span><br><span class="line">            err = bc.Validator().ValidateBody(block)</span><br><span class="line">        }</span><br><span class="line">        ...</span><br><span class="line">        state, err := state.New(parent.Root(), bc.stateCache)</span><br><span class="line">        <span class="keyword">if</span> err != <span class="literal">nil</span> {</span><br><span class="line">            <span class="keyword">return</span> i, events, coalescedLogs, err</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        receipts, logs, usedGas, err := bc.processor.Process(...)</span><br><span class="line">        <span class="keyword">if</span> err != <span class="literal">nil</span> {</span><br><span class="line">            bc.reportBlock(block, receipts, err)</span><br><span class="line">            <span class="keyword">return</span> i, events, coalescedLogs, err</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        err = bc.Validator().ValidateState(...)</span><br><span class="line">        <span class="keyword">if</span> err != <span class="literal">nil</span> {</span><br><span class="line">            bc.reportBlock(block, receipts, err)</span><br><span class="line">            <span class="keyword">return</span> i, events, coalescedLogs, err</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        status, err := bc.WriteBlockWithState(...)</span><br><span class="line">        <span class="keyword">if</span> err != <span class="literal">nil</span> {</span><br><span class="line">            <span class="keyword">return</span> i, events, coalescedLogs, err</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">switch</span> status {</span><br><span class="line">        <span class="keyword">case</span> CanonStatTy:</span><br><span class="line">            ...</span><br><span class="line">        <span class="keyword">case</span> SideStatTy:</span><br><span class="line">            ...</span><br><span class="line">    }</span><br><span class="line">    ...</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>, events, coalescedLogs, <span class="literal">nil</span></span><br><span class="line">}</span><br></pre></td></tr></table></figure></p>
<ul>
<li>Message &#x6570;&#x636E;&#x7ED3;&#x6784;&#x5C55;&#x793A;<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Message <span class="keyword">struct</span> {</span><br><span class="line">    to         *common.Address</span><br><span class="line">    from       common.Address</span><br><span class="line">    nonce      <span class="keyword">uint64</span></span><br><span class="line">    amount     *big.Int</span><br><span class="line">    gasLimit   <span class="keyword">uint64</span></span><br><span class="line">    gasPrice   *big.Int</span><br><span class="line">    data       []<span class="keyword">byte</span></span><br><span class="line">    checkNonce <span class="keyword">bool</span></span><br><span class="line">}</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="3-2-&#x6D41;&#x7A0B;&#x56FE;&#x7EC6;&#x8282;"><a href="#3-2-&#x6D41;&#x7A0B;&#x56FE;&#x7EC6;&#x8282;" class="headerlink" title="3.2 &#x6D41;&#x7A0B;&#x56FE;&#x7EC6;&#x8282;"></a>3.2 &#x6D41;&#x7A0B;&#x56FE;&#x7EC6;&#x8282;</h3><ol start="2">
<li>&#x4EA4;&#x6613;&#x5904;&#x7406;&#x8FC7;&#x7A0B;&#x8C03;&#x7528; <code>state_processer.go</code> &#x7684; <code>Process()</code> &#x51FD;&#x6570;&#x5BF9;&#x533A;&#x5757;&#x4E2D;&#x7684;&#x6240;&#x6709;&#x4EA4;&#x6613;&#x8FDB;&#x884C;&#x9010;&#x4E00;&#x5904;&#x7406;&#x3002;<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">file: core\state_processor.go</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(p *StateProcessor)</span> <span class="title">Process</span><span class="params">(...)</span> <span class="params">(types.Receipts, []*types.Log, <span class="keyword">uint64</span>, error)</span></span> {</span><br><span class="line">    ...</span><br><span class="line">    <span class="keyword">for</span> i, tx := <span class="keyword">range</span> block.Transactions() {</span><br><span class="line">        statedb.Prepare(tx.Hash(), block.Hash(), i)</span><br><span class="line">        receipt, _, err := ApplyTransaction(...)</span><br><span class="line">        <span class="keyword">if</span> err != <span class="literal">nil</span> {</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">nil</span>, <span class="literal">nil</span>, <span class="number">0</span>, err</span><br><span class="line">        }</span><br><span class="line">        receipts = <span class="built_in">append</span>(receipts, receipt)</span><br><span class="line">        allLogs = <span class="built_in">append</span>(allLogs, receipt.Logs...)</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    p.engine.Finalize(...)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> receipts, allLogs, *usedGas, <span class="literal">nil</span></span><br><span class="line">}</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>2a. <code>AsMessage()</code> &#x51FD;&#x6570;&#x5C06; <code>Transaction</code> &#x6570;&#x636E;&#x7ED3;&#x6784;&#x8F6C;&#x6362;&#x4E3A; <code>Message</code> &#x6570;&#x636E;&#x7ED3;&#x6784;<br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">msg, err := tx.AsMessage(types.MakeSigner(config, header.Number))</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> {</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">nil</span>, <span class="number">0</span>, err</span><br><span class="line">}</span><br></pre></td></tr></table></figure></p>
<p>2b. <code>newEvm()</code> &#x4E3A;&#x5408;&#x7EA6;&#x7684;&#x6267;&#x884C;&#x521B;&#x5EFA;&#x865A;&#x62DF;&#x673A;&#x73AF;&#x5883;&#x3002;<br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">context := NewEVMContext(msg, header, bc, author)</span><br><span class="line">vmenv := vm.NewEVM(context, statedb, config, cfg)</span><br></pre></td></tr></table></figure></p>
<p>2c. <code>ApplyMessage()</code> &#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x65B0;&#x7684;&#x72B6;&#x6001;&#x53D8;&#x66F4;&#x5B9E;&#x4F8B;&#xFF0C;&#x5E76;&#x4E14;&#x8C03;&#x7528; <code>state_transition.go</code> &#x7684; <code>TransitionDb()</code> &#x51FD;&#x6570;&#x5E94;&#x7528;&#x5408;&#x7EA6;&#x4EE3;&#x7801;&#x5230;&#x8FD9;&#x4E2A;&#x5B9E;&#x4F8B;&#x4E2D;&#xFF0C;&#x53D1;&#x751F;&#x5B9E;&#x8D28;&#x4E0A;&#x7684;&#x72B6;&#x6001;&#x8F6C;&#x79FB;&#x8BB0;&#x5F55;&#x3002; <code>TransitionDb()</code> &#x9996;&#x5148;&#x4F1A;&#x8FDB;&#x884C;&#x4EA4;&#x6613;&#x6267;&#x884C;&#x7684;&#x5165;&#x53E3;&#x68C0;&#x67E5;&#xFF0C;&#x786E;&#x8BA4; nonce, gas &#x662F;&#x5426;&#x5408;&#x6CD5;&#x53EF;&#x7528;&#xFF1B;&#x968F;&#x540E;&#x6839;&#x636E;&#x662F;&#x5408;&#x7EA6;&#x521B;&#x5EFA;&#x8FD8;&#x662F;&#x5408;&#x7EA6;&#x8C03;&#x7528;&#xFF0C;&#x9009;&#x62E9; <code>Create()</code> &#x6216;&#x8005; <code>Call()</code>&#xFF0C;&#x5728;&#x5408;&#x7EA6;&#x90E8;&#x7F72;&#x4E2D;&#xFF0C;&#x6B64;&#x5904;&#x4F1A;&#x8C03;&#x7528; <code>Call()</code></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">file: core\state_transition.go</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(st *StateTransition)</span> <span class="title">TransitionDb</span><span class="params">()</span> <span class="params">()</span></span> {</span><br><span class="line">    <span class="keyword">if</span> err = st.preCheck(); err != <span class="literal">nil</span> {</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    }</span><br><span class="line">    ...</span><br><span class="line">    contractCreation := msg.To() == <span class="literal">nil</span></span><br><span class="line">    ...</span><br><span class="line">    <span class="keyword">if</span> contractCreation {</span><br><span class="line">        ret, _, st.gas, vmerr = evm.Create(...)</span><br><span class="line">    } <span class="keyword">else</span> {</span><br><span class="line">        st.state.SetNonce(msg.From(), st.state.GetNonce(sender.Address())+<span class="number">1</span>)</span><br><span class="line">        ret, st.gas, vmerr = evm.Call(...)  <span class="comment">// &#x5408;&#x7EA6;&#x8C03;&#x7528;</span></span><br><span class="line">    }</span><br><span class="line">    ...</span><br><span class="line">    <span class="keyword">return</span> ret, st.gasUsed(), vmerr != <span class="literal">nil</span>, err</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<p>&#x4E0B;&#x9762;&#x8FDB;&#x5165;&#x5230;&#x5408;&#x7EA6;&#x8C03;&#x7528;<strong>&#x6700;&#x6838;&#x5FC3;&#x7684;&#x6D41;&#x7A0B;</strong>&#xFF0C;&#x7531; <code>core\vm\evm.go</code> &#x7684; <code>Call()</code> &#x5B8C;&#x6210;&#x3002;&#x5728;&#x771F;&#x6B63;&#x8C03;&#x7528;&#x524D;&#xFF0C;&#x4F1A;&#x505A;&#x4E00;&#x4E9B;&#x57FA;&#x672C;&#x7684;&#x5408;&#x6CD5;&#x6027;&#x68C0;&#x67E5;&#xFF0C;&#x4F8B;&#x5982;&#x4F59;&#x989D;&#x662F;&#x5426;&#x8DB3;&#x591F;&#x8FDB;&#x884C;&#x8F6C;&#x8D26;&#xFF0C;&#x8D26;&#x6237;&#x5408;&#x6CD5;&#x6027;&#x7B49;&#x3002;&#x6CE8;&#x610F;&#x6B64;&#x5904;&#x82E5;&#x5BF9;&#x8C61;&#x8D26;&#x6237;&#x4E0D;&#x5B58;&#x5728;&#xFF0C;&#x5185;&#x90E8;&#x4F1A;&#x4E3A;&#x8D26;&#x6237;&#x5730;&#x5740;&#x521B;&#x5EFA;&#x65B0;&#x7684;&#x8D26;&#x6237;&#x3002;<code>run()</code> &#x51FD;&#x6570;&#x5C06;&#x6267;&#x884C;&#x5408;&#x7EA6;&#x4EE3;&#x7801;&#xFF0C;&#x7B2C;&#x4E09;&#x4E2A;&#x53C2;&#x6570;&#x4E3A;nil&#xFF0C;&#x4EE3;&#x8868;&#x4E0D;&#x8C03;&#x7528;&#x5408;&#x7EA6;&#x4E2D;&#x7684;&#x4EFB;&#x4F55;&#x51FD;&#x6570;&#xFF0C;&#x53EA;&#x662F;&#x521D;&#x59CB;&#x5316;&#x3002;</p>
<p>Tips&#xFF1A;Ethereum &#x4E2D;&#xFF0C;&#x5728;&#x8FDB;&#x884C;&#x8D26;&#x6237;&#x7684;&#x67E5;&#x8BE2;&#x529F;&#x80FD;&#x548C;&#x8F6C;&#x8D26;&#x529F;&#x80FD;&#x65F6;&#xFF0C;&#x90FD;&#x662F;&#x5408;&#x7EA6;&#x8C03;&#x7528;&#x4EA4;&#x6613;&#x3002;&#x4F46;&#x662F;&#x6211;&#x4EEC;&#x77E5;&#x9053;&#xFF0C;&#x67E5;&#x8BE2;&#x52A8;&#x4F5C;&#x5B9E;&#x9645;&#x65E0;&#x9700;&#x4E0A;&#x94FE;&#xFF0C;&#x8F6C;&#x8D26;&#x624D;&#x9700;&#x8981;&#x3002;Ethereum &#x628A;&#x8FD9;&#x9879;&#x63A7;&#x5236;&#x8BBE;&#x8BA1;&#x5728;&#x4E86;&#x667A;&#x80FD;&#x5408;&#x7EA6;&#x7684;&#x7F16;&#x5199;&#x4E2D;&#xFF0C;&#x901A;&#x8FC7;sol&#x8BED;&#x8A00;&#x7684;&#x51FD;&#x6570;&#x4FEE;&#x9970;&#x5173;&#x952E;&#x5B57;&#x6765;&#x63A7;&#x5236;&#x3002;</p>
<blockquote>
<p>&#x5728;Solidity&#x4E2D;<code>constant&#x3001;view&#x3001;pure</code>&#x4E09;&#x4E2A;&#x51FD;&#x6570;&#x4FEE;&#x9970;&#x8BCD;&#x7684;&#x4F5C;&#x7528;&#x662F;&#x544A;&#x8BC9;&#x7F16;&#x8BD1;&#x5668;&#xFF0C;&#x51FD;&#x6570;&#x4E0D;&#x6539;&#x53D8;/&#x4E0D;&#x8BFB;&#x53D6;&#x72B6;&#x6001;&#x53D8;&#x91CF;&#xFF0C;&#x8FD9;&#x6837;&#x51FD;&#x6570;&#x6267;&#x884C;&#x5C31;&#x53EF;&#x4EE5;&#x4E0D;&#x6D88;&#x8017;gas&#x4E86;&#xFF0C;&#x56E0;&#x4E3A;&#x4E0D;&#x9700;&#x8981;&#x77FF;&#x5DE5;&#x6765;&#x9A8C;&#x8BC1;&#x3002;&#x5728;Solidity v4.17&#x4E4B;&#x524D;&#xFF0C;&#x53EA;&#x6709;constant&#xFF0C;&#x540E;&#x7EED;&#x7248;&#x672C;&#x5C06;constant&#x62C6;&#x6210;&#x4E86;view&#x548C;pure&#x3002;view&#x7684;&#x4F5C;&#x7528;&#x548C;constant&#x4E00;&#x6A21;&#x4E00;&#x6837;&#xFF0C;&#x53EF;&#x4EE5;&#x8BFB;&#x53D6;&#x72B6;&#x6001;&#x53D8;&#x91CF;&#x4F46;&#x662F;&#x4E0D;&#x80FD;&#x6539;&#xFF1B;pure&#x5219;&#x66F4;&#x4E3A;&#x4E25;&#x683C;&#xFF0C;pure&#x4FEE;&#x9970;&#x7684;&#x51FD;&#x6570;&#x4E0D;&#x80FD;&#x6539;&#x4E5F;&#x4E0D;&#x80FD;&#x8BFB;&#x72B6;&#x6001;&#x53D8;&#x91CF;&#xFF0C;&#x667A;&#x80FD;&#x64CD;&#x4F5C;&#x51FD;&#x6570;&#x5185;&#x90E8;&#x53D8;&#x91CF;&#xFF0C;&#x5426;&#x5219;&#x7F16;&#x8BD1;&#x901A;&#x4E0D;&#x8FC7;&#x3002;<br>&#x4F5C;&#x8005;&#xFF1A;Kirn<br>&#x94FE;&#x63A5;&#xFF1A;<a href="https://www.jianshu.com/p/52eec7ac5413" target="_blank" rel="noopener">https://www.jianshu.com/p/52eec7ac5413</a><br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">file: core\vm\evm.go</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(evm *EVM)</span> <span class="title">Call</span><span class="params">(...)</span> <span class="params">(...)</span></span> {</span><br><span class="line">    <span class="keyword">if</span> evm.vmConfig.NoRecursion &amp;&amp; evm.depth &gt; <span class="number">0</span> {</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span>, gas, <span class="literal">nil</span></span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">if</span> evm.depth &gt; <span class="keyword">int</span>(params.CallCreateDepth) {</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span>, gas, ErrDepth</span><br><span class="line">    }</span><br><span class="line">    <span class="comment">// &#x4F59;&#x989D;&#x662F;&#x5426;&#x5145;&#x8DB3;</span></span><br><span class="line">    <span class="keyword">if</span> !evm.Context.CanTransfer(evm.StateDB, caller.Address(), value) {</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span>, gas, ErrInsufficientBalance</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> (</span><br><span class="line">        to       = AccountRef(addr)</span><br><span class="line">        snapshot = evm.StateDB.Snapshot()</span><br><span class="line">    )</span><br><span class="line">    <span class="keyword">if</span> !evm.StateDB.Exist(addr) {</span><br><span class="line">        ...</span><br><span class="line">        <span class="comment">// &#x5BF9;&#x65B9;&#x5730;&#x5740;&#x65E0;&#x8D26;&#x6237;&#xFF0C;&#x5219;&#x521B;&#x5EFA;</span></span><br><span class="line">        evm.StateDB.CreateAccount(addr)</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// &#x5728;DB&#x5C42;&#x9762;&#x6267;&#x884C;&#x8F6C;&#x8D26;&#x52A8;&#x4F5C;</span></span><br><span class="line">    evm.Transfer(evm.StateDB, caller.Address(), to.Address(), value)</span><br><span class="line">    <span class="comment">// &#x4E3A;&#x5F53;&#x524D;&#x5408;&#x7EA6;&#x6267;&#x884C;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x4E34;&#x65F6;&#x7684;&#x5408;&#x7EA6;</span></span><br><span class="line">    contract := NewContract(caller, to, value, gas)</span><br><span class="line">    contract.SetCallCode(&amp;addr, evm.StateDB.GetCodeHash(addr), evm.StateDB.GetCode(addr))</span><br><span class="line"></span><br><span class="line">    ...</span><br><span class="line"></span><br><span class="line">    ret, err = run(evm, contract, input)</span><br><span class="line">    <span class="comment">// &#x8C03;&#x7528;&#x5931;&#x8D25;&#xFF0C;&#x6839;&#x636E;&#x5FEB;&#x7167;&#x56DE;&#x6EDA;&#x6570;&#x636E;</span></span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> {</span><br><span class="line">        evm.StateDB.RevertToSnapshot(snapshot)</span><br><span class="line">        ...</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> ret, contract.Gas, err</span><br><span class="line">}</span><br></pre></td></tr></table></figure></p>
</blockquote>
<ol start="3">
<li><code>blockchain.go</code> &#x7684; <code>WriteBlockWithState()</code> &#x5C06;&#x6389;&#x7528; <code>accessors_chain.go</code> &#x7684; 3a. <code>WriteBlock()</code> 3b. <code>WriteReceipts()</code> &#x5199;&#x5165;&#x533A;&#x5757;&#x548C;&#x6536;&#x636E;&#x3002;</li>
</ol>
<h2 id="4-API-&#x83B7;&#x53D6;&#x6536;&#x636E;"><a href="#4-API-&#x83B7;&#x53D6;&#x6536;&#x636E;" class="headerlink" title="4 API &#x83B7;&#x53D6;&#x6536;&#x636E;"></a>4 API &#x83B7;&#x53D6;&#x6536;&#x636E;</h2><h3 id="4-1-&#x6982;&#x8FF0;"><a href="#4-1-&#x6982;&#x8FF0;" class="headerlink" title="4.1 &#x6982;&#x8FF0;"></a>4.1 &#x6982;&#x8FF0;</h3><p>&#x5728;&#x4E0A;&#x9762;&#x7684;&#x6D41;&#x7A0B;&#x4E2D;&#xFF0C;&#x4EA4;&#x6613;&#x6267;&#x884C;&#x5B8C;&#x6BD5;&#x540E;&#xFF0C;&#x4E0D;&#x4F1A;&#x663E;&#x5F0F;&#x5730;&#x5411;&#x8BF7;&#x6C42;&#x7AEF;&#x56DE;&#x590D;&#x4EFB;&#x4F55;&#x4EA4;&#x6613;&#x6267;&#x884C;&#x7684;&#x5177;&#x4F53;&#x60C5;&#x51B5;&#x3002;&#x5728; Ethereum &#x533A;&#x5757;&#x94FE;&#x7F51;&#x7EDC;&#x4E2D;&#xFF0C;&#x9700;&#x8981;&#x8BF7;&#x6C42;&#x7AEF;&#x663E;&#x5F0F;&#x5730;&#x8BF7;&#x6C42;&#x4EA4;&#x6613;&#x6536;&#x636E;&#xFF0C;&#x4EE5;&#x6B64;&#x6765;&#x786E;&#x8BA4;&#x4EA4;&#x6613;&#x6267;&#x884C;&#x7684;&#x60C5;&#x51B5;&#x3002;&#x4ECE;&#x4E0A;&#x4E00;&#x8282;&#x7684;&#x7B2C;3&#x6B65;&#x9AA4;&#x53EF;&#x77E5;&#xFF0C;&#x4EA4;&#x6613;&#x6267;&#x884C;&#x6536;&#x636E;&#x5DF2;&#x7ECF;&#x5199;&#x5165;&#x4E86;db&#x4E2D;&#xFF0C;&#x8BF7;&#x6C42;&#x7AEF;&#x8981;&#x505A;&#x7684;&#x662F;&#x53D1;&#x751F;&#x83B7;&#x53D6;&#x4EA4;&#x6613;&#x6536;&#x636E;&#x8BF7;&#x6C42;&#x3002;</p>
<h3 id="4-2-&#x6D41;&#x7A0B;&#x56FE;&#x7EC6;&#x8282;"><a href="#4-2-&#x6D41;&#x7A0B;&#x56FE;&#x7EC6;&#x8282;" class="headerlink" title="4.2 &#x6D41;&#x7A0B;&#x56FE;&#x7EC6;&#x8282;"></a>4.2 &#x6D41;&#x7A0B;&#x56FE;&#x7EC6;&#x8282;</h3><ol start="4">
<li><code>ethapi/api.go</code> &#x8BC6;&#x522B;&#x5230;&#x8FD9;&#x662F;&#x4E00;&#x6B21;&#x4EA4;&#x6613;&#x53D1;&#x9001;&#x8BF7;&#x6C42;&#xFF0C;&#x8C03;&#x7528; <code>GetTransactionReceipt()</code> &#x51FD;&#x6570;&#xFF0C;&#x8FDB;&#x4E00;&#x6B65;&#x5411;&#x5E95;&#x5C42;&#x53D1;&#x9001;&#x6D88;&#x606F;&#x3002;&#x5982;&#x679C;&#x6536;&#x636E;&#x4E2D;&#x7684;&#x5408;&#x7EA6;&#x5730;&#x5740;&#x4E0D;&#x662F;&#x5168;0&#xFF0C;&#x5219;&#x8BA4;&#x4E3A;&#x662F;&#x4E00;&#x6B21;&#x5408;&#x7EA6;&#x90E8;&#x7F72;&#x8FC7;&#x7A0B;&#xFF0C;&#x586B;&#x5199;&#x4EA4;&#x6613;&#x4E2D;&#x7684;&#x5408;&#x7EA6;&#x5730;&#x5740;&#x5230;&#x6536;&#x636E;&#x4E2D;&#x4F9B;&#x8BF7;&#x6C42;&#x7AEF;&#x4F7F;&#x7528;&#x3002;<br> 4a. &#x8C03;&#x7528;<code>ReadTransaction()</code> &#x51FD;&#x6570;&#xFF0C;&#x83B7;&#x53D6;&#x4EA4;&#x6613;&#x7684;&#x57FA;&#x7840;&#x4FE1;&#x606F;<br> 4b. &#x8C03;&#x7528;<code>GetReceipts()</code> &#x51FD;&#x6570;&#xFF0C;&#x83B7;&#x53D6;&#x4EA4;&#x6613;&#x6536;&#x636E;&#xFF0C;&#x5176;&#x5185;&#x90E8;&#x4F1A;&#x8C03;&#x7528; <code>ReadHeadNumber()</code> &#x548C; <code>ReadReceipts()</code> &#x51FD;&#x6570;&#x8F85;&#x52A9;&#x64CD;&#x4F5C;&#x3002;<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">file: ethapi/api.go</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s *PublicTransactionPoolAPI)</span> <span class="title">GetTransactionReceipt</span><span class="params">(...)</span> <span class="params">(...)</span></span> {</span><br><span class="line">    tx, blockHash, blockNumber, index := rawdb.ReadTransaction(...)</span><br><span class="line">    ...</span><br><span class="line">    receipts, err := s.b.GetReceipts(ctx, blockHash)</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> {</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span>, err</span><br><span class="line">    }</span><br><span class="line">    ...</span><br><span class="line">    <span class="keyword">if</span> receipt.ContractAddress != (common.Address{}) {</span><br><span class="line">        fields[<span class="string">&quot;contractAddress&quot;</span>] = receipt.ContractAddress</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> fields, <span class="literal">nil</span></span><br><span class="line">}</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;THE END&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;</p>
<blockquote>
<p><strong>&#x672C;&#x6587;&#x6587;&#x5B57;&#x548C;&#x56FE;&#x7247;&#x5747;&#x5C5E;&#x535A;&#x4E3B;&#x539F;&#x521B;&#x3002;&#x672A;&#x7ECF;&#x6388;&#x6743;&#xFF0C;&#x4E0D;&#x5F97;&#x8F6C;&#x8F7D;&#x3002;</strong></p>
</blockquote>
  	
	  </div>     
	  

	
<div class="post-meta">
      
        <i class="iconfont icon-category"></i>       
        <a class="category-link" href="/categories/&#x533A;&#x5757;&#x94FE;/">&#x533A;&#x5757;&#x94FE;</a> 	
     
      	

      
        <i class="iconfont icon-tag"></i>     
          <a class="tag-link" href="/tags/&#x4EE5;&#x592A;&#x574A;/">&#x4EE5;&#x592A;&#x574A;</a> <a class="tag-link" href="/tags/&#x667A;&#x80FD;&#x5408;&#x7EA6;/">&#x667A;&#x80FD;&#x5408;&#x7EA6;</a>    
      	
</div>





<div class="post-footer">
  <div class="pf-left">
      <img class="pf-avatar" src="/images/header.jpg">
      <p class="pf-des">CMB Fintech Blockchain&#x7814;&#x53D1;</p>
  </div>

  <div class="pf-right">           
      <div class="pf-links">
        




<span class="donate-btn" data-hover="&#x8D5E;&#x8D4F;">
	<span class="iconfont icon-donate"></span>
</span>


<div id="donate-box" class="sildeUpMin">

	<span class="donate-cancel iconfont icon-cancel"></span>

	<div class="donate-img-box">
		<img id="donate-qr-wechat" class="donate-img" src="/images/donate1.png" alt="No Donate Image!">	
		<img id="donate-qr-alipay" class="donate-img lazyload" src="/images/placeholder.gif" alt="No Donate Image!" data-src="/images/donate2.png">	
	</div>

	<span class="donate-word">Fintech &#x8BA9;&#x4E16;&#x754C;&#x66F4;&#x7F8E;&#x597D;</span>

	<div class="donate-list">
		<span class="iconfont icon-donate-wechat"></span>
		<span class="iconfont icon-donate-alipay"></span>
	</div>

</div>

 
        
	
<script id="-mob-share" src="http://f1.webshare.mob.com/code/mob-share.js?appkey=21d601593a1de"></script>
	
	<span class="share-btn" data-hover="&#x5206;&#x4EAB;">
	<span class="iconfont icon-share"></span>
	</span>


	<div class="-mob-share sildeUpMin">
		   
			<div data-hover="weixin">               
            <a class="iconfont  icon-share-weixin -mob-share-weixin"></a>
			</div>
     	   
			<div data-hover="weibo">               
            <a class="iconfont  icon-share-weibo -mob-share-weibo"></a>
			</div>
     	   
			<div data-hover="douban">               
            <a class="iconfont  icon-share-douban -mob-share-douban"></a>
			</div>
     	   
	</div>
	


      </div>  
    <nav class="pf-paginator">
           
        
      
        
        <a href="/2018/06/01/Ethereum&#x4EE5;&#x592A;&#x574A;&#x667A;&#x80FD;&#x5408;&#x7EA6;&#x90E8;&#x7F72;&#x6E90;&#x7801;&#x5206;&#x6790;/" data-hover="Ethereum &#x4EE5;&#x592A;&#x574A;&#x667A;&#x80FD;&#x5408;&#x7EA6;&#x90E8;&#x7F72;&#x6E90;&#x7801;&#x5206;&#x6790;"> &#x4E0B;&#x4E00;&#x7BC7;</a>
            
  </nav>   
  </div>
</div> 
	
	

</article>



	<div id="toc">		

		<div class="toc-container">	

		<span class="toc-contents"> 
			&#x76EE;&#x5F55;
		</span>

		<ul class="toc-list"></ul>

		</div>

	</div>


        </section> 

    </div>        

    
    
    <div id="backTop" class="iconfont icon-backtotop"></div> 

  
    

        
        <div class="search-container sildeUpMin">


            <div class="search-header">
            <input type="text" placeholder="&#x8F93;&#x5165;&#x4F60;&#x60F3;&#x641C;&#x7D22;&#x7684;" id="search-input" class="search-input">  
            <span class="search-cancel iconfont icon-cancel"></span>
          
            </div>
              
            <div id="search-result" class="search-result"></div>

        </div>
 

     <div class="mobile-menu">      

      
      <img class="mobile-menu-icon lazyload" src="/images/placeholder.gif" data-src="/images/favicon.png">   
      

         
            

            <a class="mobile-menu-link" href="/">&#x9996;&#x9875;
            </a>
            
         
            

            <a class="mobile-menu-link" href="/archives">&#x5F52;&#x6863;
            </a>
            
         
            

            <a class="mobile-menu-link" href="/tags">&#x6807;&#x7B7E;
            </a>
            
         
            

            <a class="mobile-menu-link" href="/about">&#x5173;&#x4E8E;
            </a>
            
         
                          

            <a class="mobile-menu-link mobile-menu-search" href="#">&#x641C;&#x7D22; </a>                 
            
         
      
</div>        
    



     
    
    <script src="/main.bundle.js"></script>        
    <footer id="footer">
	   
   	 

	  	
   	
	   
      	 

	
	

	 <div>
	 	&#xA9;
		
		2018			
	
		
		&#x666F;&#x68A6;&#x56ED;	 

	 </div>
	
   
   	 <div>
	
	 <a href="http://hexo.io/" target="_blank">Hexo</a>

	 Theme

	 <a href="https://github.com/Lemonreds/hexo-theme-Nayo" target="_blank">Nayo</a> 

	 </div>	


	
	
</footer>   
  </body>        
</html>